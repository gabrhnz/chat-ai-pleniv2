# üß† C√≥mo Hacer el Bot M√°s Inteligente

El bot usa **RAG (Retrieval-Augmented Generation)**, que combina b√∫squeda sem√°ntica + LLM. Aqu√≠ te muestro c√≥mo mejorarlo:

---

## üéØ NIVEL 1: Mejoras Inmediatas (Sin C√≥digo)

### 1. **Agregar M√°s FAQs** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: ALTO**

M√°s FAQs = M√°s conocimiento

```sql
-- Agrega FAQs variadas sobre el mismo tema
INSERT INTO faqs (question, answer, category, keywords) VALUES

-- Diferentes formas de preguntar lo mismo
('¬øCu√°nto cuesta la UNC?', 'La UNC es gratuita...', 'costos', ARRAY['costo', 'precio']),
('¬øEs gratis estudiar en la UNC?', 'S√≠, es gratuita...', 'costos', ARRAY['gratis', 'gratuita']),
('¬øHay que pagar matr√≠cula?', 'No, la matr√≠cula es gratuita...', 'costos', ARRAY['matr√≠cula', 'pagar']);
```

### 2. **Mejorar las Respuestas** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: ALTO**

Respuestas m√°s completas = Bot m√°s √∫til

**‚ùå Respuesta Mala:**
```
"S√≠, hay becas."
```

**‚úÖ Respuesta Buena:**
```
"S√≠, la UNC ofrece varios tipos de becas:

1. **Becas Acad√©micas**: Para estudiantes con excelente rendimiento
2. **Becas Socioecon√≥micas**: Para estudiantes con necesidades econ√≥micas
3. **Becas Deportivas**: Para atletas destacados

Para solicitar una beca:
- Completa el formulario en l√≠nea
- Presenta documentos de respaldo
- Espera la evaluaci√≥n (2-3 semanas)

M√°s informaci√≥n: https://unc.edu.ve/becas o contacta a becas@unc.edu.ve"
```

### 3. **Usar Keywords Inteligentes** ‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: MEDIO-ALTO**

```sql
-- Incluye sin√≥nimos, variaciones, errores comunes
keywords: ARRAY[
  'inscripci√≥n', 'inscripcion', -- sin tilde
  'admisi√≥n', 'admision',
  'ingreso', 'entrada',
  'registro', 'matricula',
  'como entrar', 'como ingresar'
]
```

---

## üéØ NIVEL 2: Ajustar Par√°metros (F√°cil)

### 1. **Ajustar Similarity Threshold** ‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: MEDIO**

En Vercel, cambia la variable:

```
SIMILARITY_THRESHOLD=0.7  # Actual (m√°s estricto)
SIMILARITY_THRESHOLD=0.6  # M√°s flexible (encuentra m√°s FAQs)
SIMILARITY_THRESHOLD=0.8  # M√°s estricto (solo respuestas muy relevantes)
```

**Recomendaci√≥n:** Empieza con `0.6` y ajusta seg√∫n resultados.

### 2. **Aumentar TOP_K_RESULTS** ‚≠ê‚≠ê‚≠ê
**Impacto: MEDIO**

```
TOP_K_RESULTS=5   # Actual
TOP_K_RESULTS=10  # M√°s contexto (respuestas m√°s completas)
```

**Nota:** M√°s resultados = respuestas m√°s lentas pero m√°s completas.

### 3. **Ajustar Temperatura** ‚≠ê‚≠ê‚≠ê
**Impacto: MEDIO**

```
TEMPERATURE=0.3  # Actual (m√°s preciso, menos creativo)
TEMPERATURE=0.5  # Balance
TEMPERATURE=0.7  # M√°s creativo, menos preciso
```

**Recomendaci√≥n:** `0.3-0.4` para FAQs (precisi√≥n), `0.6-0.8` para conversaci√≥n.

### 4. **Aumentar MAX_TOKENS** ‚≠ê‚≠ê
**Impacto: BAJO-MEDIO**

```
MAX_TOKENS=500   # Actual (respuestas cortas)
MAX_TOKENS=800   # Respuestas m√°s largas
MAX_TOKENS=1000  # Respuestas muy detalladas
```

**Nota:** M√°s tokens = Mayor costo en OpenRouter.

---

## üéØ NIVEL 3: Mejoras de C√≥digo (Intermedio)

### 1. **Mejorar el System Prompt** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: ALTO**

Edita `src/services/rag.service.js`:

```javascript
const systemPrompt = `Eres un asistente virtual experto de la Universidad Nacional de las Ciencias Dr. Humberto Fern√°ndez-Mor√°n (UNC).

PERSONALIDAD:
- Amigable y entusiasta
- Profesional pero cercano
- Usa emojis ocasionalmente üéì
- Tutea al usuario

CONOCIMIENTO:
- Ubicaci√≥n: Sector Altos de Pipe, km 11, Miranda, Venezuela
- Lema: "Ciencia, Tecnolog√≠a e Innovaci√≥n para el Desarrollo"
- Enfoque: Carreras cient√≠ficas y tecnol√≥gicas de 4 a√±os

INSTRUCCIONES:
1. Responde SOLO con informaci√≥n de las FAQs proporcionadas
2. Si no sabes algo, sugiere contactar: https://unc.edu.ve/ o redes sociales
3. Menciona siempre la duraci√≥n (4 a√±os) al hablar de carreras
4. S√© espec√≠fico con ubicaciones, fechas y contactos
5. Si la pregunta es ambigua, pide aclaraci√≥n
6. Termina con una pregunta de seguimiento cuando sea apropiado

TONO:
- "¬°Claro! Te cuento sobre..."
- "La UNC ofrece..."
- "¬øTe gustar√≠a saber m√°s sobre...?"

FORMATO:
- Usa listas cuando sea apropiado
- Resalta informaci√≥n importante con **negritas**
- Incluye enlaces cuando sea relevante`;
```

### 2. **Agregar Contexto de Conversaci√≥n** ‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: ALTO**

Permite que el bot recuerde la conversaci√≥n:

```javascript
// En tu frontend
const conversationHistory = [];

async function sendMessage(message) {
  const response = await fetch(`${API_URL}/api/chat`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      message: message,
      context: conversationHistory.slice(-4) // √öltimos 4 mensajes
    })
  });
  
  const data = await response.json();
  
  // Guardar en historial
  conversationHistory.push(
    { role: 'user', content: message },
    { role: 'assistant', content: data.reply }
  );
  
  return data.reply;
}
```

### 3. **Agregar Fallback Inteligente** ‚≠ê‚≠ê‚≠ê
**Impacto: MEDIO**

Edita `src/services/rag.service.js` en la funci√≥n `assembleContext`:

```javascript
if (faqs.length === 0) {
  return {
    systemPrompt,
    userPrompt: `El usuario pregunt√≥: "${query}"

No encontr√© informaci√≥n espec√≠fica en la base de datos, pero puedo ayudarte de estas formas:

1. **Preguntas frecuentes disponibles:**
   - Informaci√≥n general de la UNC
   - Carreras y programas
   - Proceso de admisi√≥n
   - Ubicaci√≥n y contacto

2. **Recursos √∫tiles:**
   - Sitio web: https://unc.edu.ve/
   - Instagram: @unc.oficial
   - Email: info@unc.edu.ve

¬øPodr√≠as reformular tu pregunta o decirme sobre qu√© tema espec√≠fico necesitas informaci√≥n?`,
  };
}
```

---

## üéØ NIVEL 4: Funciones Avanzadas (Avanzado)

### 1. **Agregar B√∫squeda H√≠brida** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: ALTO**

Combina b√∫squeda sem√°ntica + b√∫squeda de texto completo:

```javascript
// En src/services/rag.service.js
async function hybridSearch(query, embedding) {
  // B√∫squeda sem√°ntica (actual)
  const { data: semanticResults } = await supabase.rpc('match_faqs', {
    query_embedding: embedding,
    match_threshold: SIMILARITY_THRESHOLD,
    match_count: TOP_K_RESULTS,
  });
  
  // B√∫squeda de texto completo
  const { data: textResults } = await supabase
    .from('faqs')
    .select('*')
    .or(`question.ilike.%${query}%,answer.ilike.%${query}%`)
    .limit(5);
  
  // Combinar y eliminar duplicados
  const combined = [...semanticResults, ...textResults];
  const unique = Array.from(new Map(combined.map(item => [item.id, item])).values());
  
  return unique.slice(0, TOP_K_RESULTS);
}
```

### 2. **Agregar Analytics** ‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: MEDIO**

Aprende qu√© preguntan los usuarios:

```javascript
// Guardar cada pregunta
async function logQuery(query, foundAnswer) {
  await supabase.from('analytics').insert({
    query: query,
    found_answer: foundAnswer,
    timestamp: new Date().toISOString()
  });
}

// Luego analiza qu√© preguntas no tienen respuesta
SELECT query, COUNT(*) as count
FROM analytics
WHERE found_answer = false
GROUP BY query
ORDER BY count DESC
LIMIT 20;
```

### 3. **Agregar Feedback de Usuario** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: ALTO**

Permite que usuarios califiquen respuestas:

```javascript
// En tu frontend, despu√©s de cada respuesta
<button onClick={() => rateResponse(messageId, 'helpful')}>üëç √ötil</button>
<button onClick={() => rateResponse(messageId, 'not-helpful')}>üëé No √∫til</button>

async function rateResponse(messageId, rating) {
  await fetch(`${API_URL}/api/feedback`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      message_id: messageId,
      rating: rating
    })
  });
}
```

### 4. **Agregar Sugerencias Autom√°ticas** ‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: MEDIO-ALTO**

Muestra preguntas relacionadas:

```javascript
// Despu√©s de cada respuesta, sugiere preguntas relacionadas
const relatedQuestions = sources
  .slice(1, 4)
  .map(s => s.question);

return {
  reply: answer,
  sources: sources,
  suggestions: relatedQuestions
};
```

---

## üéØ NIVEL 5: Inteligencia Avanzada (Experto)

### 1. **Fine-tuning del Modelo** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: MUY ALTO** | **Costo: MEDIO**

Entrena un modelo espec√≠fico para la UNC:

1. Recopila 100-500 conversaciones reales
2. Usa OpenAI Fine-tuning API
3. Entrena modelo personalizado
4. Costo: ~$10-50 USD

### 2. **Multi-turn Conversation** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: MUY ALTO**

Implementa memoria de conversaci√≥n completa:

```javascript
// Guardar sesiones en Supabase
const sessionId = generateSessionId();

await supabase.from('sessions').insert({
  session_id: sessionId,
  messages: conversationHistory,
  user_id: userId
});
```

### 3. **Procesamiento de Documentos** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
**Impacto: MUY ALTO**

Permite subir PDFs, documentos:

```javascript
// Procesar documento y crear chunks
import { PDFLoader } from 'langchain/document_loaders';

const loader = new PDFLoader('reglamento.pdf');
const docs = await loader.load();

// Dividir en chunks y generar embeddings
for (const doc of docs) {
  const embedding = await generateEmbedding(doc.pageContent);
  await supabase.from('documents').insert({
    content: doc.pageContent,
    embedding: embedding
  });
}
```

---

## üìä M√âTRICAS PARA MEDIR INTELIGENCIA

### 1. **Tasa de Respuesta**
```sql
SELECT 
  COUNT(CASE WHEN found_answer THEN 1 END) * 100.0 / COUNT(*) as success_rate
FROM analytics;
```

**Meta:** >85% de preguntas respondidas

### 2. **Satisfacci√≥n de Usuario**
```sql
SELECT 
  COUNT(CASE WHEN rating = 'helpful' THEN 1 END) * 100.0 / COUNT(*) as satisfaction
FROM feedback;
```

**Meta:** >80% de respuestas √∫tiles

### 3. **Tiempo de Respuesta**
```sql
SELECT AVG(duration) as avg_response_time
FROM analytics
WHERE created_at > NOW() - INTERVAL '7 days';
```

**Meta:** <5 segundos

---

## üöÄ PLAN DE ACCI√ìN RECOMENDADO

### Semana 1: Fundamentos
- [ ] Agregar 30-50 FAQs m√°s
- [ ] Mejorar respuestas existentes
- [ ] Ajustar SIMILARITY_THRESHOLD a 0.6
- [ ] Mejorar system prompt

### Semana 2: Optimizaci√≥n
- [ ] Implementar analytics b√°sico
- [ ] Agregar feedback de usuarios
- [ ] Ajustar par√°metros seg√∫n datos
- [ ] Agregar sugerencias de preguntas

### Semana 3: Avanzado
- [ ] Implementar contexto de conversaci√≥n
- [ ] Agregar b√∫squeda h√≠brida
- [ ] Crear interfaz de administraci√≥n
- [ ] Monitorear y ajustar

### Mes 2+: Expansi√≥n
- [ ] Procesar documentos oficiales
- [ ] Fine-tuning si es necesario
- [ ] Multi-idioma (si aplica)
- [ ] Integraci√≥n con otros sistemas

---

## üí° TIPS PRO

1. **Calidad > Cantidad**: 50 FAQs buenas > 200 FAQs malas
2. **Itera Constantemente**: Revisa analytics semanalmente
3. **Escucha a los Usuarios**: El feedback es oro
4. **Prueba Todo**: Haz preguntas t√∫ mismo regularmente
5. **Documenta Cambios**: Lleva registro de qu√© funciona

---

## üÜò ERRORES COMUNES

### ‚ùå "El bot responde cosas inventadas"
**Soluci√≥n:** Baja la TEMPERATURE a 0.2-0.3

### ‚ùå "No encuentra FAQs obvias"
**Soluci√≥n:** Baja SIMILARITY_THRESHOLD a 0.5-0.6

### ‚ùå "Respuestas muy gen√©ricas"
**Soluci√≥n:** Mejora el system prompt y las FAQs

### ‚ùå "Muy lento"
**Soluci√≥n:** Reduce TOP_K_RESULTS y MAX_TOKENS

---

¬°Con estas mejoras, tu bot ser√° mucho m√°s inteligente! üß†‚ú®

**Empieza por el Nivel 1 y ve subiendo gradualmente.** üöÄ

